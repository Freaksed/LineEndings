/** IntroAnimationView  *	---------------------------------------------------------------------------- *  *	@author:  *		Christian Widodo [christian@avatarlabs.com]  *	---------------------------------------------------------------------------- */ 	package com.boogabooga.ui.gamelevel	{		import flash.display.Bitmap;		import flash.display.MovieClip;		import flash.events.Event;		import flash.events.EventDispatcher;		import flash.geom.Point;		import flash.text.TextField;		import flash.text.TextFieldAutoSize;		import flash.text.TextFormat;				import com.avatarlabs.utils.UtilFunctions;		import com.avatarlabs.utils.cache.BitmapDataManager;		import com.avatarlabs.utils.console.ConsoleBroadcaster;		import com.avatarlabs.utils.events.CustomEvent;		import com.avatarlabs.utils.events.EventNotificationCenter;		import com.avatarlabs.utils.sound.SoundEffectPlayer;		import com.avatarlabs.utils.text.TextFormatting;		import com.avatarlabs.utils.userinterface.PlayToRewindTo;		import com.avatarlabs.utils.userinterface.UIButton;		import com.greensock.TweenLite;		import org.osflash.signals.Signal;				import com.boogabooga.data.SoundData;		import com.boogabooga.data.SoundsIndex;		import com.boogabooga.data.StringsIndex;		import com.boogabooga.data.maingame.Village;		import com.boogabooga.data.gamelevel.AbstractGameObject;		import com.boogabooga.data.gamelevel.GameLevelDataIndex;		import com.boogabooga.events.BoogaEvent;				public class IntroAnimationView extends EventDispatcher		{			protected var _contentClip:MovieClip;			protected var _running:Boolean;						protected var _bubble1TextOriginalPosition:Point;			protected var _bubble2TextOriginalPosition:Point;			protected var _maxText1Height:Number;			protected var _originalText1Format:TextFormat;			protected var _maxText2Height:Number;			protected var _originalText2Format:TextFormat;						public var onTutorialLevelGateShut:Signal;			public var onTutorialLevelVillagerRunningStopped:Signal;			public var onTutorialLevelIntroFinished:Signal;			public var onTutorialLevelEnemySpawned:Signal;						/**	Stage Instances **/			public var bubble1_mc:MovieClip;			public var bubble2_mc:MovieClip;			/**	End of Stage Instances **/						/** Constructor			  *	---------------------------------------------------------------------------- */				public function IntroAnimationView()				{					//init();				}								public function set contentClip( m:MovieClip ):void				{					_contentClip = m;					_contentClip.stop();										bubble1_mc = _contentClip.bubble1_mc;					bubble2_mc = _contentClip.bubble2_mc;					bubble2_mc.visible = false;					bubble2_mc.alpha = 1;										_bubble1TextOriginalPosition = new Point( bubble1_mc.label_txt.x, bubble1_mc.label_txt.y );					_bubble2TextOriginalPosition = new Point( bubble2_mc.label_txt.x, bubble2_mc.label_txt.y );										_maxText1Height = bubble1_mc.label_txt.height;					_originalText1Format = UtilFunctions.clone( bubble1_mc.label_txt.getTextFormat() ) as TextFormat;										_maxText2Height = bubble2_mc.label_txt.height;					_originalText2Format = UtilFunctions.clone( bubble1_mc.label_txt.getTextFormat() ) as TextFormat;				}				public function get contentClip():MovieClip { return _contentClip; }								public function get running():Boolean { return _running; }							/** init			  *	---------------------------------------------------------------------------- */				public function init():void				{					_contentClip.addEventListener( "onPlayPluckSound", handlePlayPluckSound, false, 0, true );					_contentClip.addEventListener( "onPlayMonsterRoarSound", handlePlayMonsterRoarSound, false, 0, true );					_contentClip.addEventListener( "onPlayExclamationSound", handlePlayExclamationSound, false, 0, true );					_contentClip.addEventListener( "onPlayMonsterStepSound", handlePlayMonsterStepSound, false, 0, true );					_contentClip.addEventListener( "onPlayTenseMusic", handlePlayTenseMusic, false, 0, true );					_contentClip.addEventListener( "onPlayGateShutSound", handlePlayGateShutSound, false, 0, true );					_contentClip.addEventListener( "onPlayVillagerRunningSound", handlePlayVillagerRunningSound, false, 0, true );					_contentClip.addEventListener( "onStopVillagerRunningSound", handleStopVillagerRunningSound, false, 0, true );					_contentClip.addEventListener( "onShowTutorialLevelTextThree", handleShowTutorialLevelTextThree, false, 0, true );					_contentClip.addEventListener( "onHideTutorialBuble", handleHideTutorialBuble, false, 0, true );					_contentClip.addEventListener( "onShowTutorialLevelTextFour", handleShowTutorialLevelTextFour, false, 0, true );					_contentClip.addEventListener( "onSpawnEnemy", handleSpawnEnemy, false, 0, true );					_contentClip.addEventListener( "onIntroAnimationFinished", handleIntroAnimationFinished, false, 0, true );										onTutorialLevelGateShut = new Signal();					onTutorialLevelVillagerRunningStopped = new Signal();					onTutorialLevelIntroFinished = new Signal();					onTutorialLevelEnemySpawned = new Signal();				}								public function kill():void				{					_bubble1TextOriginalPosition = null;					_bubble2TextOriginalPosition = null;					_originalText1Format = null;					_originalText2Format = null;										_contentClip.stop();					SoundEffectPlayer.getInstance().stopSound( "booga_tense_music_loop.wav", "booga_tense_music_loop.wav", "booga_tense_music_loop.wav" );					SoundEffectPlayer.getInstance().stopSound( "booga_intro_happy_cue_with_birds.wav", "booga_intro_happy_cue_with_birds.wav", "booga_intro_happy_cue_with_birds.wav" );										_contentClip.removeEventListener( "onPlayPluckSound", handlePlayPluckSound );					_contentClip.removeEventListener( "onPlayMonsterRoarSound", handlePlayMonsterRoarSound );					_contentClip.removeEventListener( "onPlayExclamationSound", handlePlayExclamationSound );					_contentClip.removeEventListener( "onPlayMonsterStepSound", handlePlayMonsterStepSound );					_contentClip.removeEventListener( "onPlayTenseMusic", handlePlayTenseMusic );					_contentClip.removeEventListener( "onPlayGateShutSound", handlePlayGateShutSound );					_contentClip.removeEventListener( "onPlayVillagerRunningSound", handlePlayVillagerRunningSound );					_contentClip.removeEventListener( "onStopVillagerRunningSound", handleStopVillagerRunningSound );					_contentClip.removeEventListener( "onShowTutorialLevelTextThree", handleShowTutorialLevelTextThree );					_contentClip.removeEventListener( "onHideTutorialBuble", handleHideTutorialBuble );					_contentClip.removeEventListener( "onShowTutorialLevelTextFour", handleShowTutorialLevelTextFour );					_contentClip.removeEventListener( "onSpawnEnemy", handleSpawnEnemy );					_contentClip.removeEventListener( "onIntroAnimationFinished", handleIntroAnimationFinished );										onTutorialLevelGateShut = null;					onTutorialLevelVillagerRunningStopped = null;					onTutorialLevelIntroFinished = null;					onTutorialLevelEnemySpawned = null;				}							/** show			  *	---------------------------------------------------------------------------- */				public function show():void				{					_contentClip.visible = true;				}							/** hide			  *	---------------------------------------------------------------------------- */				public function hide():void				{					_contentClip.visible = false;				}								public function pause():void				{					_contentClip.stop();				}								public function unpause():void				{					_contentClip.play();				}							/** showTutorialText			  *	---------------------------------------------------------------------------- */				public function startIntro():void				{					trace( "startIntro();" );										_running = true;										SoundEffectPlayer.getInstance().playLibrarySound( "booga_intro_happy_cue_with_birds.wav", false, "booga_intro_happy_cue_with_birds.wav", "booga_intro_happy_cue_with_birds.wav" );										_contentClip.play();				}							/** showTutorialText			  *	---------------------------------------------------------------------------- */				public function stopIntro():void				{					_running = false;										_contentClip.stop();				}								protected function resizeText1( m:MovieClip, text:String ):void				{					m.label_txt.setTextFormat( _originalText1Format );										TextFormatting.formatTextWithFontName( m.label_txt, text, "Lithos Pro Black", false, TextFieldAutoSize.CENTER );					var tf:TextFormat = m.label_txt.getTextFormat();										//trace( "m.label_txt.height: "+m.label_txt.height );					//trace( "_maxText1Height: "+_maxText1Height );										if( m.label_txt.height < _maxText1Height )					{						while( m.label_txt.height < _maxText1Height )						{							tf.size += 1;							m.label_txt.setTextFormat(tf);						}												//m.label_txt.text = ' ';						tf.size = Number(tf.size) - 1;						m.label_txt.setTextFormat(tf);												//trace( "font size: "+m.label_txt.getTextFormat().size );					}										//trace( "font size: "+m.label_txt.getTextFormat().size );									}								protected function resizeText2( m:MovieClip, text:String ):void				{					m.label_txt.setTextFormat( _originalText2Format );										TextFormatting.formatTextWithFontName( m.label_txt, text, "Lithos Pro Black", false, TextFieldAutoSize.CENTER );					var tf:TextFormat = m.label_txt.getTextFormat();										//trace( "m.label_txt.height: "+m.label_txt.height );					//trace( "_maxText1Height: "+_maxText1Height );										if( m.label_txt.height < _maxText2Height )					{						while( m.label_txt.height < _maxText2Height )						{							tf.size += 1;							m.label_txt.setTextFormat(tf);						}												//m.label_txt.text = ' ';						tf.size = Number(tf.size) - 1;						m.label_txt.setTextFormat(tf);												//trace( "font size: "+m.label_txt.getTextFormat().size );					}										//trace( "font size: "+m.label_txt.getTextFormat().size );									}							/** showTutorialText			  *	---------------------------------------------------------------------------- */				public function showTutorialText( s:String ):void				{					//TextFormatting.formatTextWithFontName( bubble2_mc.label_txt, s, "Lithos Pro Black", false, TextFieldAutoSize.CENTER );										resizeText2( bubble2_mc, s );					bubble2_mc.label_txt.y = _bubble2TextOriginalPosition.y + (bubble2_mc.height - bubble2_mc.label_txt.height - _bubble2TextOriginalPosition.y*2)/2;										bubble2_mc.visible = true;				}							/** hideTutorialText			  *	---------------------------------------------------------------------------- */				public function hideTutorialText():void				{					bubble2_mc.visible = false;				}							/** handlePlayPluckSound			  *	---------------------------------------------------------------------------- */				protected function handlePlayPluckSound( event:Event ):void				{					ConsoleBroadcaster.broadcast( "IntroAnimationView", "handlePlayPluckSound();" );										SoundEffectPlayer.getInstance().playLibrarySound( "flower_pluck_sound.wav", false, "flower_pluck_sound.wav", "flower_pluck_sound.wav" );				}							/** handlePlayMonsterRoarSound			  *	---------------------------------------------------------------------------- */				protected function handlePlayMonsterRoarSound( event:Event ):void				{					SoundEffectPlayer.getInstance().stopSound( "booga_intro_happy_cue_with_birds.wav", "booga_intro_happy_cue_with_birds.wav", "booga_intro_happy_cue_with_birds.wav" );					SoundEffectPlayer.getInstance().playLibrarySound( "monster_roar.wav", false, "monster_roar.wav", "monster_roar.wav" );				}							/** handlePlayExclamationSound			  *	---------------------------------------------------------------------------- */				protected function handlePlayExclamationSound( event:Event ):void				{					SoundEffectPlayer.getInstance().playLibrarySound( "exclamation_boing.wav", false, "exclamation_boing.wav", "exclamation_boing.wav" );				}							/** handlePlayMonsterStepSound			  *	---------------------------------------------------------------------------- */				protected function handlePlayMonsterStepSound( event:Event ):void				{					SoundEffectPlayer.getInstance().playLibrarySound( "monster_footstep.wav", false, "monster_footstep.wav", "monster_footstep.wav" );				}							/** handlePlayTenseMusic			  *	---------------------------------------------------------------------------- */				protected function handlePlayTenseMusic( event:Event ):void				{					SoundEffectPlayer.getInstance().playLibrarySound( "booga_tense_music_loop.wav", true, "booga_tense_music_loop.wav", "booga_tense_music_loop.wav" );				}							/** handlePlayGateShutSound			  *	---------------------------------------------------------------------------- */				protected function handlePlayGateShutSound( event:Event ):void				{					SoundEffectPlayer.getInstance().playLibrarySound( "gate_shutting.wav", false, "gate_shutting.wav", "gate_shutting.wav" );					onTutorialLevelGateShut.dispatch();				}							/** handlePlayVillagerRunningSound			  *	---------------------------------------------------------------------------- */				protected function handlePlayVillagerRunningSound( event:Event ):void				{					SoundEffectPlayer.getInstance().playLibrarySound( "villager_running.wav", false, "villager_running.wav", "villager_running.wav" );				}							/** handleStopVillagerRunningSound			  *	---------------------------------------------------------------------------- */				protected function handleStopVillagerRunningSound( event:Event ):void				{					SoundEffectPlayer.getInstance().stopSound( "villager_running.wav", "villager_running.wav", "villager_running.wav" );										onTutorialLevelVillagerRunningStopped.dispatch();				}							/** handleShowTutorialLevelTextThree			  *	---------------------------------------------------------------------------- */				protected function handleShowTutorialLevelTextThree( event:Event ):void				{					trace( "handleShowTutorialLevelTextThree();" );										//TextFormatting.formatTextWithFontName( bubble1_mc.label_txt, StringsIndex.getInstance().getStringByName("TUTORIAL_LEVEL_3"), "Lithos Pro Black", false, TextFieldAutoSize.CENTER );					resizeText1( bubble1_mc, StringsIndex.getInstance().getStringByName("TUTORIAL_LEVEL_3") );					bubble1_mc.visible = true;										bubble1_mc.label_txt.y = _bubble1TextOriginalPosition.y + (bubble1_mc.height - bubble1_mc.label_txt.height - _bubble1TextOriginalPosition.y*2)/2;				}							/** handleHideTutorialBuble			  *	---------------------------------------------------------------------------- */				protected function handleHideTutorialBuble( event:Event ):void				{					bubble1_mc.visible = false;				}							/** handleShowTutorialLevelTextFour			  *	---------------------------------------------------------------------------- */				protected function handleShowTutorialLevelTextFour( event:Event ):void				{					trace( "handleShowTutorialLevelTextFour();" );										//TextFormatting.formatTextWithFontName( bubble1_mc.label_txt, StringsIndex.getInstance().getStringByName("TUTORIAL_LEVEL_4"), "Lithos Pro Black", false, TextFieldAutoSize.CENTER );					resizeText1( bubble1_mc, StringsIndex.getInstance().getStringByName("TUTORIAL_LEVEL_4") );					bubble1_mc.visible = true;										bubble1_mc.label_txt.y = _bubble1TextOriginalPosition.y + (bubble1_mc.height - bubble1_mc.label_txt.height - _bubble1TextOriginalPosition.y*2)/2;				}							/** handleSpawnEnemy			  *	---------------------------------------------------------------------------- */				protected function handleSpawnEnemy( event:Event ):void				{					onTutorialLevelEnemySpawned.dispatch();				}							/** handleIntroAnimationFinished			  *	---------------------------------------------------------------------------- */				protected function handleIntroAnimationFinished( event:Event ):void				{					_running = false;										onTutorialLevelIntroFinished.dispatch();										SoundEffectPlayer.getInstance().stopSound( "booga_tense_music_loop.wav", "booga_tense_music_loop.wav", "booga_tense_music_loop.wav" );				}						}	}