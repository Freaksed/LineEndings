/** ResultScreenWin  *	---------------------------------------------------------------------------- *  *	@author:  *		Christian Widodo [christian@avatarlabs.com]  *	---------------------------------------------------------------------------- */ 	package com.boogabooga.ui.gamelevel	{		import flash.display.Bitmap;		import flash.display.MovieClip;		import flash.events.Event;		import flash.events.EventDispatcher;		import flash.events.TimerEvent;		import flash.geom.Rectangle;		import flash.text.TextField;		import flash.text.TextFieldAutoSize;				import com.avatarlabs.utils.cache.BitmapDataManager;		import com.avatarlabs.utils.console.ConsoleBroadcaster;		import com.avatarlabs.utils.events.CustomEvent;		import com.avatarlabs.utils.sound.SoundEffectPlayer;		import com.avatarlabs.utils.text.TextFormatting;		import com.avatarlabs.utils.timers.CustomTimer;		import com.avatarlabs.utils.userinterface.PlayToRewindTo;		import com.avatarlabs.utils.userinterface.UIButton;		import com.greensock.TweenLite;				import com.boogabooga.data.SoundsIndex;		import com.boogabooga.data.gamelevel.AbstractGameObject;		import com.boogabooga.data.gamelevel.GameLevelCurrentData;		import com.boogabooga.data.gamelevel.GameLevelDataIndex;		import com.boogabooga.data.maingame.Village;		import com.boogabooga.events.BoogaEvent;				public class ResultScreenWin extends EventDispatcher		{			//protected var _glitterEffect_ptrt:PlayToRewindTo;			protected var _contentClip:MovieClip;						protected var _villageSavedClips:Vector.<MovieClip>;			protected var _villageSavedClipsLength:int;			protected var _currentVillageSavedClip:MovieClip;			protected var _currentVillageSavedIndex:int;						protected var _winAnimationTimer:CustomTimer;			protected var _villagerCelebrationSfx:Object;			protected var _villagerCelebrationSfxs:Vector.<Object>;			protected var _villagerCelebrationSfxsLength:int;						/**	Stage Instances **/			public var starEffect_mc:MovieClip;			public var villageSaved1_mc:MovieClip;			//public var newflag_mc:MovieClip;			//public var firework1_mc:MovieClip;			//public var firework2_mc:MovieClip;			//public var firework3_mc:MovieClip;			//public var firework4_mc:MovieClip;			//public var firework5_mc:MovieClip;			//public var confetti1_mc:MovieClip;			//public var confetti2_mc:MovieClip;			//public var confetti3_mc:MovieClip;			//public var confetti4_mc:MovieClip;			//public var confetti5_mc:MovieClip;			//public var confetti6_mc:MovieClip;			//public var label_mc:MovieClip;			//public var glitterEffect_mc:MovieClip;			/**	End of Stage Instances **/						/** Constructor			  *	---------------------------------------------------------------------------- */				public function ResultScreenWin()				{					//init();				}								public function set contentClip( m:MovieClip ):void				{					_contentClip = m;					_contentClip.stop();										//_contentClip.addEventListener( "onPlayFirework1", handlePlayFirework1 );					//_contentClip.addEventListener( "onPlayFirework2", handlePlayFirework2 );					//_contentClip.addEventListener( "onPlayFirework3", handlePlayFirework3 );					//_contentClip.addEventListener( "onPlayFirework4", handlePlayFirework4 );					//_contentClip.addEventListener( "onPlayFirework5", handlePlayFirework5 );					//_contentClip.addEventListener( "onPlayConfetti", handlePlayConfetti );					_contentClip.addEventListener( "onPlayWinMusic", handlePlayWinMusic );					_contentClip.addEventListener( "onPlayVillagerCelebration", handlePlayVillagerCelebration );					_contentClip.addEventListener( "onPlayVillageSavedAnimation", handlePlayVillageSavedAnimation );					//_contentClip.addEventListener( "onPlayAnimationComplete", handlePlayAnimationComplete, false, 0, true );										starEffect_mc = _contentClip.starEffect_mc;					starEffect_mc.stop();					starEffect_mc.visible = false;					villageSaved1_mc = _contentClip.villageSaved1_mc;					villageSaved1_mc.stop();					villageSaved1_mc.visible = false;					villageSaved1_mc.character1_mc.stop();					villageSaved1_mc.character2_mc.stop();					villageSaved1_mc.character3_mc.stop();					villageSaved1_mc.character4_mc.stop();					villageSaved1_mc.character5_mc.stop();					villageSaved1_mc.island1_mc.visible = false;					villageSaved1_mc.island2_mc.visible = false;					villageSaved1_mc.island3_mc.visible = false;					villageSaved1_mc.island4_mc.visible = false;					//villageSaved1_mc.scrollRect = new Rectangle( 0, 0, 760, 625 );										//newflag_mc = _contentClip.newflag_mc;					//newflag_mc.visible = false;					//newflag_mc.gotoAndStop(1);										//firework1_mc = _contentClip.firework1_mc;					//firework1_mc.visible = false;					//firework1_mc.gotoAndStop(1);					//firework2_mc = _contentClip.firework2_mc;					//firework2_mc.gotoAndStop(1);					//firework3_mc = _contentClip.firework3_mc;					//firework3_mc.gotoAndStop(1);					//firework4_mc = _contentClip.firework4_mc;					//firework4_mc.gotoAndStop(1);					//firework5_mc = _contentClip.firework5_mc;					//firework5_mc.gotoAndStop(1);										//confetti1_mc = _contentClip.confetti1_mc;					//confetti1_mc.gotoAndStop(1);					//confetti2_mc = _contentClip.confetti2_mc;					//confetti2_mc.gotoAndStop(1);					//confetti3_mc = _contentClip.confetti3_mc;					//confetti3_mc.gotoAndStop(1);					//confetti4_mc = _contentClip.confetti4_mc;					//confetti4_mc.gotoAndStop(1);					//stopConfettiAnimation( confetti4_mc );					//confetti5_mc = _contentClip.confetti5_mc;					//confetti5_mc.gotoAndStop(1);					//stopConfettiAnimation( confetti5_mc );					//confetti6_mc = _contentClip.confetti6_mc;					//confetti6_mc.gotoAndStop(1);					//stopConfettiAnimation( confetti6_mc );										//label_mc = _contentClip.label_mc;					//glitterEffect_mc = _contentClip.glitterEffect_mc;				}				public function get contentClip():MovieClip { return _contentClip; }								//public function set villagerCelebrationSfx( s:String ):void { _villagerCelebrationSfx = s; }				public function get villagerCelebrationSfx():Object { return _villagerCelebrationSfx; }							/** init			  *	---------------------------------------------------------------------------- */				public function init():void				{					_winAnimationTimer = new CustomTimer( 6000, 1 );					//_winAnimationTimer.addEventListener( TimerEvent.TIMER_COMPLETE, handleWinAnimationTimerCompleted, false, 0, true );					_winAnimationTimer.onTimerCompleted.add( handleWinAnimationTimerCompleted );										_villagerCelebrationSfxs = new Vector.<Object>;					_villagerCelebrationSfxs.push( {url:"files/assets/sounds/gameplay_win_villager_celebration_1.swf", id:"sfx_villagers_celebration_1.mp3"} );					_villagerCelebrationSfxs.push( {url:"files/assets/sounds/gameplay_win_villager_celebration_2.swf", id:"sfx_villagers_celebration_2.mp3"} );					_villagerCelebrationSfxs.push( {url:"files/assets/sounds/gameplay_win_villager_celebration_3.swf", id:"sfx_villagers_celebration_3.mp3"} );					_villagerCelebrationSfxs.push( {url:"files/assets/sounds/gameplay_win_villager_celebration_4.swf", id:"sfx_villagers_celebration_4.mp3"} );					_villagerCelebrationSfxs.push( {url:"files/assets/sounds/gameplay_win_villager_celebration_5.swf", id:"sfx_villagers_celebration_5.mp3"} );					_villagerCelebrationSfxs.push( {url:"files/assets/sounds/gameplay_win_villager_celebration_6.swf", id:"sfx_villagers_celebration_6.mp3"} );					_villagerCelebrationSfxs.push( {url:"files/assets/sounds/gameplay_win_villager_celebration_7.swf", id:"sfx_villagers_celebration_7.mp3"} );					_villagerCelebrationSfxs.push( {url:"files/assets/sounds/gameplay_win_villager_celebration_8.swf", id:"sfx_villagers_celebration_8.mp3"} );					_villagerCelebrationSfxs.push( {url:"files/assets/sounds/gameplay_win_villager_celebration_9.swf", id:"sfx_villagers_celebration_9.mp3"} );					_villagerCelebrationSfxs.push( {url:"files/assets/sounds/gameplay_win_villager_celebration_10.swf", id:"sfx_villagers_celebration_10.mp3"} );					_villagerCelebrationSfxsLength = _villagerCelebrationSfxs.length;										_villageSavedClips = new Vector.<MovieClip>;					_villageSavedClips.push( villageSaved1_mc );					_villageSavedClipsLength = _villageSavedClips.length;										//label_mc.stop();					//glitterEffect_mc.gotoAndStop(1);										//_glitterEffect_ptrt = new PlayToRewindTo();					//_glitterEffect_ptrt.reciever = glitterEffect_mc;										//TextFormatting.formatTextWithFontName( label_mc.animation_mc.label_txt, "Villagers Safe !", "SF Fedora", false, TextFieldAutoSize.CENTER );					//TextFormatting.formatTextWithFontName( label_mc.animation2_mc.label_txt, "Villagers Safe !", "SF Fedora", false, TextFieldAutoSize.CENTER );					//TextFormatting.formatTextWithFontName( label_mc.animation_mc.label_txt, "Villagers Safe !", "Lithos Pro Black", false, TextFieldAutoSize.CENTER );					//TextFormatting.formatTextWithFontName( label_mc.animation2_mc.label_txt, "Villagers Safe !", "Lithos Pro Black", false, TextFieldAutoSize.CENTER );				}							/** show			  *	---------------------------------------------------------------------------- */				public function show():void				{					_contentClip.visible = true;										_currentVillageSavedIndex = int(Math.random()*_villageSavedClipsLength);					_currentVillageSavedClip = _villageSavedClips[ _currentVillageSavedIndex ];										if( _currentVillageSavedIndex == 0 )					{						_currentVillageSavedClip.character1_mc.play();						_currentVillageSavedClip.character2_mc.play();						_currentVillageSavedClip.character3_mc.play();						_currentVillageSavedClip.character4_mc.play();						_currentVillageSavedClip.character5_mc.play();												if( GameLevelCurrentData.getInstance().playingIsland != null )						{							switch( GameLevelCurrentData.getInstance().playingIsland.id )							{								case 1:									_currentVillageSavedClip.island1_mc.visible = true;									break;																case 2:									_currentVillageSavedClip.island2_mc.visible = true;									break;																case 3:									_currentVillageSavedClip.island3_mc.visible = true;									break;																case 4:									_currentVillageSavedClip.island4_mc.visible = true;									break;																case 4:									break;							}						}						else						{							_currentVillageSavedClip.island1_mc.visible = true;						}					}										//newflag_mc.play();					//newflag_mc.visible = true;					//TweenLite.to( _contentClip, _contentClip.totalFrames, {useFrames:true, frame:_contentClip.totalFrames, onComplete:handlePlayAnimationComplete} );										starEffect_mc.visible = true;					starEffect_mc.play();					_contentClip.play();										//SoundEffectPlayer.getInstance().setVolume( SoundsIndex.getInstance().getSoundBySoundId("music_level_win_music.wav").volume, 0, "music_level_win_music.wav" );					SoundEffectPlayer.getInstance().playLibrarySound( "sfx_win_stars_transition.mp3", false, "sfx_win_stars_transition.mp3", "sfx_win_stars_transition.mp3", SoundEffectPlayer.SOUND_PLAYER_SFX );										_winAnimationTimer.start();										//glitterEffect_mc.gotoAndPlay(1);										//_glitterEffect_ptrt.playTo( 0, handleGlitterEffectPlayed );				}								public function pause():void				{					_contentClip.stop();										_winAnimationTimer.pause();										//newflag_mc.stop();										//firework1_mc.stop();					//firework2_mc.stop();					//firework3_mc.stop();					//firework4_mc.stop();					//firework5_mc.stop();					//confetti1_mc.stop();					//confetti2_mc.stop();					//confetti3_mc.stop();					//confetti4_mc.stop();					//stopConfettiAnimation( confetti4_mc );					//confetti5_mc.stop();					//stopConfettiAnimation( confetti5_mc );					//confetti6_mc.stop();					//stopConfettiAnimation( confetti6_mc );									}								public function unpause():void				{					_contentClip.play();										_winAnimationTimer.unpause();										//newflag_mc.play();										//if( firework1_mc.currentFrame != 1 )						//firework1_mc.play();										//if( firework2_mc.currentFrame != 1 )						//firework2_mc.play();										//if( firework3_mc.currentFrame != 1 )						//firework3_mc.play();										//if( firework4_mc.currentFrame != 1 )						//firework4_mc.play();											//if( firework5_mc.currentFrame != 1 )						//firework5_mc.play();										//if( confetti1_mc.currentFrame != 1 )						//confetti1_mc.play();										//if( confetti2_mc.currentFrame != 1 )						//confetti2_mc.play();										//if( confetti3_mc.currentFrame != 1 )						//confetti3_mc.play();										//if( confetti4_mc.currentFrame != 1 )						//confetti4_mc.play();						//playConfettiAnimation( confetti4_mc );										//if( confetti5_mc.currentFrame != 1 )						//confetti5_mc.play();						//playConfettiAnimation( confetti5_mc );										//if( confetti6_mc.currentFrame != 1 )						//confetti6_mc.play();						//playConfettiAnimation( confetti6_mc );				}				/*				private function stopConfettiAnimation( clip:MovieClip ):void				{					clip.stop();										for( var i:int=0; i<clip.animation1_mc.animation61_mc.numChildren; ++i )					{						MovieClip(clip.animation1_mc.animation61_mc.getChildAt(i)).stop();						MovieClip(clip.animation1_mc.animation62_mc.getChildAt(i)).stop();					}										clip.animation9_mc.confettiSpin1_mc.stop();					clip.animation9_mc.confettiSpin2_mc.stop();					clip.animation9_mc.confettiSpin3_mc.stop();				}								private function playConfettiAnimation( clip:MovieClip ):void				{					clip.play();										for( var i:int=0; i<clip.animation1_mc.animation61_mc.numChildren; ++i )					{						MovieClip(clip.animation1_mc.animation61_mc.getChildAt(i)).play();						MovieClip(clip.animation1_mc.animation62_mc.getChildAt(i)).play();					}										clip.animation9_mc.confettiSpin1_mc.play();					clip.animation9_mc.confettiSpin2_mc.play();					clip.animation9_mc.confettiSpin3_mc.play();				}				*/			/** hide			  *	---------------------------------------------------------------------------- */				public function hide():void				{					_contentClip.visible = false;										//TweenLite.killTweensOf( _contentClip );					_contentClip.gotoAndStop(1);										starEffect_mc.visible = false;					starEffect_mc.gotoAndStop(1);										if( _currentVillageSavedClip != null )					{						_currentVillageSavedClip.visible = false;						_currentVillageSavedClip.gotoAndStop(1);												if( _currentVillageSavedIndex == 0 )						{							_currentVillageSavedClip.character1_mc.stop();							_currentVillageSavedClip.character2_mc.stop();							_currentVillageSavedClip.character3_mc.stop();							_currentVillageSavedClip.character4_mc.stop();							_currentVillageSavedClip.character5_mc.stop();														_currentVillageSavedClip.island1_mc.visible = false;							_currentVillageSavedClip.island2_mc.visible = false;							_currentVillageSavedClip.island3_mc.visible = false;							_currentVillageSavedClip.island4_mc.visible = false;						}					}				}								private function stopWinAnimation():void				{					_winAnimationTimer.stop();					_winAnimationTimer.reset();										SoundEffectPlayer.getInstance().stopSound( "music_win_screen_loop.wav", "music_win_screen_loop.wav", "music_win_screen_loop.wav", SoundEffectPlayer.SOUND_PLAYER_SFX );					//SoundEffectPlayer.getInstance().stopSound( _villagerCelebrationSfx.id, _villagerCelebrationSfx.id, _villagerCelebrationSfx.id, SoundEffectPlayer.SOUND_PLAYER_SFX );				}								//protected function handlePlayFirework1( event:Event ):void				//{					//firework1_mc.visible = true;					//firework1_mc.play();				//}								//protected function handlePlayFirework2( event:Event ):void				//{					//firework2_mc.visible = true;					//firework2_mc.play();				//}								//protected function handlePlayFirework3( event:Event ):void				//{					//firework3_mc.visible = true;					//firework3_mc.play();				//}								//protected function handlePlayFirework4( event:Event ):void				//{					//firework4_mc.visible = true;					//firework4_mc.play();				//}								//protected function handlePlayFirework5( event:Event ):void				//{					//firework5_mc.visible = true;					//firework5_mc.play();				//}				/*				protected function handlePlayConfetti( event:Event ):void				{					//confetti1_mc.visible = true;					//confetti1_mc.play();					//confetti2_mc.visible = true;					//confetti2_mc.play();					//confetti3_mc.visible = true;					//confetti3_mc.play();					confetti4_mc.visible = true;					//confetti4_mc.play();					playConfettiAnimation( confetti4_mc );					confetti5_mc.visible = true;					//confetti5_mc.play();					playConfettiAnimation( confetti5_mc );					confetti6_mc.visible = true;					//confetti6_mc.play();					playConfettiAnimation( confetti6_mc );				}				*/								public function randomizeVillagerCelebration():String				{					_villagerCelebrationSfx = _villagerCelebrationSfxs[ int( Math.random()*_villagerCelebrationSfxsLength ) ];										//trace( 'randomize villager celebration : '+_villagerCelebrationSfx.id );										return _villagerCelebrationSfx.url;				}								private function handleWinAnimationTimerCompleted( timer:CustomTimer ):void				{					stopWinAnimation();										dispatchEvent( new BoogaEvent(BoogaEvent.ON_RESULT_SCREEN_WIN_ANIMATION_DONE) );										//hide();				}								private function handlePlayWinMusic( event:Event ):void				{					SoundEffectPlayer.getInstance().playLibrarySound( "music_win_screen_loop.wav", false, "music_win_screen_loop.wav", "music_win_screen_loop.wav", SoundEffectPlayer.SOUND_PLAYER_SFX );				}								private function handlePlayVillagerCelebration( event:Event ):void				{					if( _villagerCelebrationSfx != null )						SoundEffectPlayer.getInstance().playLibrarySound( _villagerCelebrationSfx.id, false, _villagerCelebrationSfx.id, _villagerCelebrationSfx.id, SoundEffectPlayer.SOUND_PLAYER_SFX );				}								private function handlePlayVillageSavedAnimation( event:Event ):void				{					_currentVillageSavedClip.visible = true;					_currentVillageSavedClip.play();				}							/** handlePlayAnimationComplete			  *	---------------------------------------------------------------------------- */				protected function handlePlayAnimationComplete( event:Event ):void				{					ConsoleBroadcaster.broadcast( "ResultScreenWin", "handlePlayAnimationComplete();" );										dispatchEvent( new BoogaEvent(BoogaEvent.ON_RESULT_SCREEN_WIN_ANIMATION_DONE) );				}				/*				protected function handleGlitterEffectPlayed():void				{					ConsoleBroadcaster.broadcast( "ResultScreenWin", "handleGlitterEffectPlayed();" );										dispatchEvent( new BoogaEvent(BoogaEvent.ON_RESULT_SCREEN_WIN_ANIMATION_DONE) );				}				*/		}	}