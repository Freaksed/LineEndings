/** WarningPopupView  *	---------------------------------------------------------------------------- *  *	@author:  *		Christian Widodo [christian@avatarlabs.com]  *	---------------------------------------------------------------------------- */ 	package com.boogabooga.ui.maingame.warning	{		import flash.display.Bitmap;		import flash.display.MovieClip;		import flash.events.Event;		import flash.events.EventDispatcher;		import flash.events.TimerEvent;		import flash.geom.Point;		import flash.text.TextField;		import flash.text.TextFieldAutoSize;		import flash.text.TextFormat;		import flash.utils.Timer;				import com.avatarlabs.utils.UtilFunctions;		import com.avatarlabs.utils.cache.BitmapDataManager;		import com.avatarlabs.utils.events.CustomEvent;		import com.avatarlabs.utils.events.EventNotificationCenter;		import com.avatarlabs.utils.navigation.NavigationController;		import com.avatarlabs.utils.sound.SoundEffectPlayer;		import com.avatarlabs.utils.text.TextFormatting;		import com.avatarlabs.utils.userinterface.DynamicUIArrowedSlider;		import com.avatarlabs.utils.userinterface.DynamicUIButton;		import com.avatarlabs.utils.userinterface.DynamicUIScroller;		import com.avatarlabs.utils.userinterface.DynamicUISlider;				import com.boogabooga.data.SettingsIndex;		import com.boogabooga.data.StringsIndex;		import com.boogabooga.events.BoogaEvent;		import com.boogabooga.ui.maingame.AbstractContentView;				public class WarningPopupView extends AbstractContentView		{			protected var _textScroller:DynamicUIScroller;			protected var _textSlider:DynamicUIArrowedSlider;			protected var _textWithoutImageScroller:DynamicUIScroller;			protected var _textWithoutImageSlider:DynamicUIArrowedSlider;			protected var _currentTextScroller:DynamicUIScroller;			protected var _maxTextHeight:Number;			protected var _originalTextFormat:TextFormat;			protected var _itemCacheIconId:String;						protected var _closeClip:DynamicUIButton;			protected var _bigCloseClip:DynamicUIButton;			protected var _iceWeaponsWarningContinueClip:DynamicUIButton;			protected var _fireWeaponsWarningContinueClip:DynamicUIButton;						/**	Stage Instances **/			public var text_mc:MovieClip;			public var textWithoutImage_mc:MovieClip;			public var close_mc:MovieClip;			public var bigClose_mc:MovieClip;			public var image_mc:MovieClip;			public var itemBackground_mc:MovieClip;			public var background_mc:MovieClip;			public var bigBackground_mc:MovieClip;			public var blackBackground_mc:MovieClip;			public var textWithImage_mc:MovieClip;			public var iceWeaponsWarning_mc:MovieClip;			public var fireWeaponsWarning_mc:MovieClip;			/**	End of Stage Instances **/						/** Constructor			  *	---------------------------------------------------------------------------- */				public function WarningPopupView()				{					//init();				}								override public function set contentClip( m:MovieClip ):void				{					super.contentClip = m;										blackBackground_mc = _contentClip.blackBackground_mc;					bigBackground_mc = _contentClip.bigBackground_mc;					bigBackground_mc.visible = false;					background_mc = _contentClip.background_mc;					textWithImage_mc = _contentClip.textWithImage_mc;										iceWeaponsWarning_mc = _contentClip.iceWeaponsWarning_mc;					iceWeaponsWarning_mc.visible = false;					iceWeaponsWarning_mc.cloud1_mc.stop();					iceWeaponsWarning_mc.cloud2_mc.stop();										fireWeaponsWarning_mc = _contentClip.fireWeaponsWarning_mc;					fireWeaponsWarning_mc.visible = false;					fireWeaponsWarning_mc.rain1_mc.stop();					fireWeaponsWarning_mc.rain2_mc.stop();										if( blackBackground_mc != null )						blackBackground_mc.cacheAsBitmap = true;										image_mc = textWithImage_mc.image_mc;					itemBackground_mc = textWithImage_mc.itemBackground_mc;										text_mc = textWithImage_mc.text_mc;					text_mc.visible = false;					textWithoutImage_mc = _contentClip.textWithoutImage_mc;					textWithoutImage_mc.visible = false;										_maxTextHeight = text_mc.content_mc.label_txt.height;					_originalTextFormat = UtilFunctions.clone( text_mc.content_mc.label_txt.getTextFormat() ) as TextFormat;										_textSlider = new DynamicUIArrowedSlider();					_textSlider.dynamicClip = text_mc.slider_mc;					_textSlider.dynamicInit();					_textSlider.setProperty( "y" );					_textSlider.setHandle( text_mc.slider_mc.handle_mc );					_textSlider.setBounds( text_mc.slider_mc.bound_mc );										_textScroller = new DynamicUIScroller();					_textScroller.dynamicClip = text_mc;					_textScroller.dynamicInit();					_textScroller.setSlider( _textSlider );					_textScroller.setProperty("y");					_textScroller.setContent( text_mc.content_mc );					_textScroller.setMask( text_mc.mask_mc );					_textScroller.toggleSlider();										_textWithoutImageSlider = new DynamicUIArrowedSlider();					_textWithoutImageSlider.dynamicClip = textWithoutImage_mc.slider_mc;					_textWithoutImageSlider.dynamicInit();					_textWithoutImageSlider.setProperty( "y" );					_textWithoutImageSlider.setHandle( textWithoutImage_mc.slider_mc.handle_mc );					_textWithoutImageSlider.setBounds( textWithoutImage_mc.slider_mc.bound_mc );										_textWithoutImageScroller = new DynamicUIScroller();					_textWithoutImageScroller.dynamicClip = textWithoutImage_mc;					_textWithoutImageScroller.dynamicInit();					_textWithoutImageScroller.setSlider( _textWithoutImageSlider );					_textWithoutImageScroller.setProperty("y");					_textWithoutImageScroller.setContent( textWithoutImage_mc.content_mc );					_textWithoutImageScroller.setMask( textWithoutImage_mc.mask_mc );					_textWithoutImageScroller.toggleSlider();										close_mc = _contentClip.close_mc;					_closeClip = new DynamicUIButton();					_closeClip.dynamicClip = close_mc;					_closeClip.dynamicInit();										bigClose_mc = _contentClip.bigClose_mc;					bigClose_mc.visible = false;					_bigCloseClip = new DynamicUIButton();					_bigCloseClip.dynamicClip = bigClose_mc;					_bigCloseClip.dynamicInit();										_iceWeaponsWarningContinueClip = new DynamicUIButton();					_iceWeaponsWarningContinueClip.dynamicClip = iceWeaponsWarning_mc.continue_mc;					_iceWeaponsWarningContinueClip.dynamicInit();										_fireWeaponsWarningContinueClip = new DynamicUIButton();					_fireWeaponsWarningContinueClip.dynamicClip = fireWeaponsWarning_mc.continue_mc;					_fireWeaponsWarningContinueClip.dynamicInit();										//setProperty("y");					//setContent( content_mc );					//setMask( mask_mc );					//setSlider( _slider );				}							/** init			  *	---------------------------------------------------------------------------- *			  *	---------------------------------------------------------------------------- */				override public function init():void				{					super.init();										_closeClip.addEventListener( "onClick", handleCloseClicked, false, 0, true );					_closeClip.addEventListener( "onSetFocus", handleCloseRolledOver, false, 0, true );										_iceWeaponsWarningContinueClip.addEventListener( "onClick", handleCloseClicked, false, 0, true );					_iceWeaponsWarningContinueClip.addEventListener( "onSetFocus", handleCloseRolledOver, false, 0, true );										_fireWeaponsWarningContinueClip.addEventListener( "onClick", handleCloseClicked, false, 0, true );					_fireWeaponsWarningContinueClip.addEventListener( "onSetFocus", handleCloseRolledOver, false, 0, true );										TextFormatting.formatTextWithFontName( iceWeaponsWarning_mc.header_txt, StringsIndex.getInstance().getStringByName('WARNING_NO_SNOW_CLOUD_HEADER'), "Lithos Pro Black", false, TextFieldAutoSize.CENTER );					TextFormatting.formatTextWithFontName( iceWeaponsWarning_mc.step1Number_txt, "1", "Lithos Pro Black", false, TextFieldAutoSize.CENTER );					TextFormatting.formatTextWithFontName( iceWeaponsWarning_mc.step1_txt, StringsIndex.getInstance().getStringByName('WARNING_NO_SNOW_CLOUD_1'), "Lithos Pro Black" );					TextFormatting.formatTextWithFontName( iceWeaponsWarning_mc.step2Number_txt, "2", "Lithos Pro Black", false, TextFieldAutoSize.CENTER );					TextFormatting.formatTextWithFontName( iceWeaponsWarning_mc.step2_txt, StringsIndex.getInstance().getStringByName('WARNING_NO_SNOW_CLOUD_2'), "Lithos Pro Black" );										TextFormatting.formatTextWithFontName( fireWeaponsWarning_mc.header_txt, StringsIndex.getInstance().getStringByName('WARNING_NO_UMBRELLA_HEADER'), "Lithos Pro Black", false, TextFieldAutoSize.CENTER );					TextFormatting.formatTextWithFontName( fireWeaponsWarning_mc.step1Number_txt, "1", "Lithos Pro Black", false, TextFieldAutoSize.CENTER );					TextFormatting.formatTextWithFontName( fireWeaponsWarning_mc.step1_txt, StringsIndex.getInstance().getStringByName('WARNING_NO_UMBRELLA_1'), "Lithos Pro Black" );					TextFormatting.formatTextWithFontName( fireWeaponsWarning_mc.step2Number_txt, "2", "Lithos Pro Black", false, TextFieldAutoSize.CENTER );					TextFormatting.formatTextWithFontName( fireWeaponsWarning_mc.step2_txt, StringsIndex.getInstance().getStringByName('WARNING_NO_UMBRELLA_2'), "Lithos Pro Black" );										EventNotificationCenter.getInstance().addSignalListener( BoogaEvent.ON_WARNING_SHOW, handleShow, this );					//EventNotificationCenter.getInstance().addEventListener( BoogaEvent.ON_WARNING_HIDE, handleHide, false, 0, true );				}							/** show			  *	---------------------------------------------------------------------------- *			  *	---------------------------------------------------------------------------- 				public function show():void				{					_contentClip.visible = true;									}*/							/** hide			  *	---------------------------------------------------------------------------- *			  *	---------------------------------------------------------------------------- */				override public function hide():void				{					super.hide();										text_mc.content_mc.label_txt.text = ' ';					textWithoutImage_mc.content_mc.label_txt.text = ' ';										iceWeaponsWarning_mc.visible = false;					iceWeaponsWarning_mc.cloud1_mc.gotoAndStop(1);					iceWeaponsWarning_mc.cloud2_mc.gotoAndStop(1);										fireWeaponsWarning_mc.visible = false;					fireWeaponsWarning_mc.rain1_mc.gotoAndStop(1);					fireWeaponsWarning_mc.rain2_mc.gotoAndStop(2);										EventNotificationCenter.getInstance().sendSignal( BoogaEvent.ON_WARNING_HIDE, this );				}							/** addImage			  *	---------------------------------------------------------------------------- */				protected function addImage():void				{					while( image_mc.numChildren > 0 )						image_mc.removeChildAt(0);										var iconBitmap:Bitmap = new Bitmap(BitmapDataManager.getInstance().getBitmapData(_itemCacheIconId).bitmapData);						iconBitmap.width = 100;						iconBitmap.height = 100;						iconBitmap.smoothing = true;											image_mc.addChild( iconBitmap );					iconBitmap = null;				}							/** hanldeLoadImageComplete			  *	---------------------------------------------------------------------------- */				protected function handleLoadImageComplete( event:CustomEvent ):void				{					if( event.customParameters.cacheId == _itemCacheIconId )					{						BitmapDataManager.getInstance().removeEventListener( Event.COMPLETE, handleLoadImageComplete );												addImage();					}				}											/** handleShow			  *	---------------------------------------------------------------------------- *			  *	Shows the warning popup.			  *	---------------------------------------------------------------------------- */				protected function handleShow( customParameters:Object ):void				{					if( customParameters.showIceWarning )					{						textWithImage_mc.visible = false;						textWithoutImage_mc.visible = false;						fireWeaponsWarning_mc.visible = false;												iceWeaponsWarning_mc.visible = true;						iceWeaponsWarning_mc.cloud1_mc.play();						iceWeaponsWarning_mc.cloud2_mc.play();												background_mc.visible = false;						bigBackground_mc.visible = true;						_closeClip.dynamicClip.visible = false;					}					else if( customParameters.showFireWarning )					{						textWithImage_mc.visible = false;						textWithoutImage_mc.visible = false;						iceWeaponsWarning_mc.visible = false;												fireWeaponsWarning_mc.visible = true;						fireWeaponsWarning_mc.rain1_mc.play();						fireWeaponsWarning_mc.rain2_mc.play();												background_mc.visible = false;						bigBackground_mc.visible = true;						_closeClip.dynamicClip.visible = false;					}					else					{						iceWeaponsWarning_mc.visible = false;						fireWeaponsWarning_mc.visible = false;												background_mc.visible = true;						bigBackground_mc.visible = false;						_closeClip.dynamicClip.visible = true;												if( customParameters.iconURL == undefined || customParameters.iconURL == "" )						{							_currentTextScroller = _textWithoutImageScroller;							textWithImage_mc.visible = false;							textWithoutImage_mc.visible = true;						}						else						{							_currentTextScroller = _textScroller;							textWithoutImage_mc.visible = false;							textWithImage_mc.visible = true;														_itemCacheIconId = customParameters.cacheIconId;														if( BitmapDataManager.getInstance().getBitmapData(_itemCacheIconId) == null )							{								BitmapDataManager.getInstance().addEventListener( Event.COMPLETE, handleLoadImageComplete, false, 0, true );								BitmapDataManager.getInstance().loadBitmapToCache( SettingsIndex.getInstance().contentURL+customParameters.iconURL, _itemCacheIconId );							}							else							{								addImage();							}						}												//trace( 'customParameters.text: '+customParameters.text );												_currentTextScroller.dynamicClip.content_mc.label_txt.setTextFormat( _originalTextFormat );						TextFormatting.formatTextWithFontName( _currentTextScroller.dynamicClip.content_mc.label_txt, customParameters.text, "Lithos Pro Black", false, TextFieldAutoSize.LEFT );						var tf:TextFormat = _currentTextScroller.dynamicClip.content_mc.label_txt.getTextFormat();												//trace( "_currentTextScroller.dynamicClip.content_mc.label_txt.height: "+_currentTextScroller.dynamicClip.content_mc.label_txt.height );						//trace( "_maxTextHeight: "+_maxTextHeight );												var maxCount:int = 0;												if( _currentTextScroller.dynamicClip.content_mc.label_txt.height < _maxTextHeight )						{							while( _currentTextScroller.dynamicClip.content_mc.label_txt.height < _maxTextHeight )							{								tf.size += 1;								//trace( 'tf.size: '+Number(tf.size) );								_currentTextScroller.dynamicClip.content_mc.label_txt.setTextFormat(tf);																if( ++maxCount > 50 )									break;							}														tf.size = Number(tf.size) - 1;							_currentTextScroller.dynamicClip.content_mc.label_txt.setTextFormat(tf);														//trace( "font size: "+_currentTextScroller.dynamicClip.content_mc.label_txt.getTextFormat().size );						}												//trace( "font size: "+_currentTextScroller.dynamicClip.content_mc.label_txt.getTextFormat().size );												_currentTextScroller.dynamicClip.visible = true;						_currentTextScroller.toggleSlider();					}										show();									}							/** handleHide			  *	---------------------------------------------------------------------------- *			  *	Hides the popup.			  *	---------------------------------------------------------------------------- */				/*protected function handleHide( event:CustomEvent ):void				{					hide();				}*/								protected function handleCloseClicked( event:Event ):void				{					hide();					SoundEffectPlayer.getInstance().playLibrarySound( "sfx_mouse_click.wav", false, "sfx_mouse_click.wav", "sfx_mouse_click.wav", SoundEffectPlayer.SOUND_PLAYER_SFX );				}								protected function handleCloseRolledOver( event:Event ):void				{					SoundEffectPlayer.getInstance().playLibrarySound( "sfx_mouse_rollover.wav", false, "sfx_mouse_rollover.wav", "sfx_mouse_rollover.wav", SoundEffectPlayer.SOUND_PLAYER_SFX );				}		}	}