/** CryptologyIncompletePopupView  *	---------------------------------------------------------------------------- *  *	@author:  *		Christian Widodo [christian@avatarlabs.com]  *	---------------------------------------------------------------------------- */ 	package com.boogabooga.ui.maingame.cryptology	{		import flash.display.Bitmap;		import flash.display.BitmapData;		import flash.display.Loader;		import flash.display.MovieClip;		import flash.events.Event;		import flash.events.EventDispatcher;		import flash.net.URLRequest;		import flash.system.ApplicationDomain;		import flash.system.LoaderContext;		import flash.text.TextField;		import flash.text.TextFieldAutoSize;				import com.avatarlabs.utils.cache.BitmapDataManager;		import com.avatarlabs.utils.console.ConsoleBroadcaster;		import com.avatarlabs.utils.events.AssetLoaderEvent;		import com.avatarlabs.utils.events.CustomEvent;		import com.avatarlabs.utils.text.TextFormatting;		import com.avatarlabs.utils.userinterface.UIButton;		import com.avatarlabs.utils.userinterface.UIScroller;		import com.avatarlabs.utils.userinterface.UISlider;				import com.boogabooga.controller.maingame.MainGameController;		import com.boogabooga.data.maingame.Village;		import com.boogabooga.data.gamelevel.AbstractGameObject;		import com.boogabooga.data.gamelevel.GameLevelDataIndex;		import com.boogabooga.data.maingame.Treasure;		import com.boogabooga.data.maingame.Cryptology;		import com.boogabooga.data.maingame.User;		import com.avatarlabs.utils.loader.CustomLoader;		import com.boogabooga.events.BoogaEvent;				public class CryptologyIncompletePopupView extends MovieClip		{			protected var _item:AbstractGameObject;			protected var _user:User;						//protected var _imageLoader:CustomLoader;						/**	Stage Instances **/			public var header_mc:MovieClip;			public var leftSymbol_mc:CryptologySymbol;			public var rightSymbol_mc:CryptologySymbol;			public var fbUser_mc:MovieClip;			public var buy_mc:UIButton;			public var ask_mc:UIButton;			public var exit_mc:UIButton;			/**	End of Stage Instances **/						/** Constructor			  *	---------------------------------------------------------------------------- */				public function CryptologyIncompletePopupView()				{					init();				}								public function init():void				{					//TextFormatting.formatTextWithFontName( header_mc.label_txt, "Incomplete", "SF Fedora", false, TextFieldAutoSize.CENTER );					TextFormatting.formatTextWithFontName( header_mc.label_txt, "Incomplete", "Lithos Pro Black", false, TextFieldAutoSize.CENTER );					leftSymbol_mc.showLeftSymbol();					rightSymbol_mc.showRightSymbol();										exit_mc.addEventListener( "onClick", handleExitClicked );					buy_mc.addEventListener( "onClick", handleBuyClicked );					ask_mc.addEventListener( "onClick", handleAskClicked );				}							/** setCryptology			  *	---------------------------------------------------------------------------- */				public function setCryptology( cryptology:Cryptology ):void				{					leftSymbol_mc.initItem( cryptology );				}							/** setFBUser			  *	---------------------------------------------------------------------------- */				public function setFBUser( user:User ):void				{					while( fbUser_mc.image_mc.numChildren > 0 )						fbUser_mc.image_mc.removeChildAt(0);										_user = user;										if( BitmapDataManager.getInstance().getBitmapData("UserFBProfilePic_"+user.id) == null )					{						var iconLoader:Loader = new Loader();							iconLoader.contentLoaderInfo.addEventListener( Event.COMPLETE, handleLoadIconComplete, false, 0, true );							iconLoader.load( new URLRequest(user.fbProfilePicURL), new LoaderContext(true, ApplicationDomain.currentDomain) );					}					else					{						//fbUser_mc.image_mc.addChild( new Bitmap(BitmapDataManager.getInstance().getBitmapData("UserFBProfilePic_"+user.id).bitmapData) );						addUserImage();					}										//fbUser_mc.name_txt.text = user.firstName;					TextFormatting.formatTextWithFontName( fbUser_mc.name_txt, user.name, "Lithos Pro Black", false, TextFieldAutoSize.CENTER );				}							/** handleLoadIconComplete			  *	---------------------------------------------------------------------------- */				protected function handleLoadIconComplete( event:Event ):void				{					event.currentTarget.removeEventListener( Event.COMPLETE, handleLoadIconComplete );										var bitmapData:BitmapData = new BitmapData( event.currentTarget.content.width, event.currentTarget.content.height );						bitmapData.draw( event.currentTarget.content );										BitmapDataManager.getInstance().addBitmapData( "UserFBProfilePic_"+_user.id, bitmapData );					//_user = null;										addUserImage();				}								function addUserImage():void				{					var bitmap:Bitmap = new Bitmap( BitmapDataManager.getInstance().getBitmapData("UserFBProfilePic_"+_user.id).bitmapData );						bitmap.smoothing = true;					var ratio:Number;										if( bitmap.width > bitmap.height )					{						ratio = 50 / bitmap.width;						bitmap.width = 50;						bitmap.height = bitmap.height * ratio;					}					else					{						ratio = 50 / bitmap.height;						bitmap.width = bitmap.width * ratio;						bitmap.height = 50;					}										bitmap.x = -bitmap.width/2;					bitmap.y = -bitmap.height/2;										fbUser_mc.image_mc.addChild( bitmap );				}								public function show():void				{					visible = true;				}								public function hide():void				{					visible = false;										leftSymbol_mc.reset();										dispatchEvent( new BoogaEvent(BoogaEvent.ON_POPUP_HIDE) );				}								protected function handleExitClicked( event:Event ):void				{					hide();				}								protected function handleBuyClicked( event:Event ):void				{					//TODO:					//	Hook up FB credits api here to complete cryptology				}								protected function handleAskClicked( event:Event ):void				{					dispatchEvent( new BoogaEvent(BoogaEvent.ON_CRYPTOLOGY_ASK_FRIENDS) );				}		}	}